<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Announcements - iClinic Healthcare Portal</title>    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../assets/img/iclinic-logo.png">
    <link rel="apple-touch-icon" href="../assets/img/iclinic-logo.png">

    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>    <!-- Suppress Tailwind CDN Warning -->
    <script>
        // Suppress Tailwind CDN production warning
        const originalWarn = console.warn;
        console.warn = function(...args) {
            if (args[0] && typeof args[0] === 'string' && args[0].includes('cdn.tailwindcss.com')) {
                return; // Suppress Tailwind CDN warning
            }
            originalWarn.apply(console, args);
        };
    </script>
<!-- Alpine.js -->
    <script defer src="/assets/js/libs/alpine.min.js"></script>
    
    <!-- Feather Icons -->
    <script src="/assets/js/libs/feather.min.js"></script>
    
    <!-- AOS Animation -->
    <link href="/assets/css/libs/aos.css" rel="stylesheet">
    <script src="/assets/js/libs/aos.js"></script>
    
    <!-- Inter Font -->
    <link href="/assets/css/libs/inter-font.css" rel="stylesheet">
    
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        
        /* Custom scrollbar for better UX */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #0056b3, #003d82);
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #004494, #002d61);
        }
        
        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.06);
        }
        
        /* Sidebar gradient */
        .gradient-bg-sidebar {
            background: linear-gradient(135deg, #0056b3 0%, #003d82 100%);
            position: relative;
        }
        
        .gradient-bg-sidebar::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg, transparent, rgba(253, 184, 19, 0.1), transparent);
            pointer-events: none;
        }
        
        /* Active sidebar item */
        .sidebar-item-active {
            background: linear-gradient(90deg, rgba(253, 184, 19, 0.2) 0%, rgba(253, 184, 19, 0.05) 100%);
            border-left: 4px solid #FDB813;
            box-shadow: 0 0 20px rgba(253, 184, 19, 0.2);
        }
        
        /* Announcement card animations */
        .announcement-card {
            transition: all 0.3s ease;
        }
        
        .announcement-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
        }
        
        /* Statistics card animations */
        .stat-card {
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 28px rgba(0, 0, 0, 0.12);
        }
        
        /* Priority badges */
        .priority-high {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .priority-medium {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }
        
        .priority-low {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        /* Mobile responsive adjustments */
        @media (max-width: 768px) {
            .sidebar-collapsed {
                transform: translateX(-100%);
                position: fixed;
                z-index: 50;
            }
            
            .sidebar-collapsed.mobile-open {
                transform: translateX(0);
            }
        }
            
        /* Prevent modal flash before Alpine loads */
        [x-cloak] { display: none !important; }
    </style>
</head>
<body class="bg-white transition-colors duration-200" x-data="{
    sidebarCollapsed: false,
    mobileMenuOpen: false,
    profileDropdown: false,
    showLogoutConfirm: false,
    announcements: [],
    loading: false,
    selectedCategory: 'all',
    searchQuery: '',
    lastUpdated: null,
    apiError: false,
    
    init() {
        // âœ… FIXED: Load real data first, no sample data
        this.$nextTick(() => {
            this.safeFeatherReplace();
            // Load real announcements from database
            this.loadAnnouncements();
            AOS.init({
                duration: 600,
                once: true,
                offset: 50
            });
        });
        
        this.handleResize();
        window.addEventListener('resize', () => this.handleResize());
        
        // ðŸ”„ REAL-TIME POLLING: Auto-refresh announcements every 30 seconds
        // This ensures students see new announcements, deletions, and expirations automatically
        setInterval(() => {
            console.log('ðŸ”„ Auto-refreshing announcements...');
            this.loadAnnouncementsSilently();
        }, 30000); // 30 seconds
    },
    
    safeFeatherReplace() {
        if (typeof feather === 'undefined') return;
        
        try {
            // Get all feather icons
            const icons = document.querySelectorAll('[data-feather]');
            
            icons.forEach(icon => {
                try {
                    // Check if the icon element is valid and has a parent
                    if (icon && icon.parentNode && icon.parentNode.nodeType === Node.ELEMENT_NODE) {
                        const iconName = icon.getAttribute('data-feather');
                        
                        // Check if the icon name is valid in feather library
                        if (feather.icons && feather.icons[iconName]) {
                            // Create SVG element
                            const svgString = feather.icons[iconName].toSvg({
                                class: icon.className,
                                width: icon.style.width || '24',
                                height: icon.style.height || '24'
                            });
                            
                            // Create a temporary div to parse the SVG
                            const tempDiv = document.createElement('div');
                            tempDiv.innerHTML = svgString;
                            const svgElement = tempDiv.firstChild;
                            
                            // Copy all attributes from original icon to SVG
                            Array.from(icon.attributes).forEach(attr => {
                                if (attr.name !== 'data-feather') {
                                    svgElement.setAttribute(attr.name, attr.value);
                                }
                            });
                            
                            // Replace the icon only if parent still exists
                            if (icon.parentNode) {
                                icon.parentNode.replaceChild(svgElement, icon);
                            }
                        }
                    }
                } catch (e) {
                    // Silently ignore individual icon errors
                    console.debug('Feather icon replacement failed for individual icon:', e);
                }
            });
        } catch (e) {
            console.debug('Feather icons initialization failed:', e);
        }
    },
    
    handleResize() {
        if (window.innerWidth < 768) {
            this.sidebarCollapsed = true;
        }
    },
    
    async loadAnnouncements() {
        try {
            this.loading = true;
            this.apiError = false;
            
            const response = await fetch('/api/announcements');
            if (response.ok) {
                const data = await response.json();
                // âœ… FIXED: Accept empty array as valid response
                if (data !== null && data !== undefined) {
                    this.announcements = data;
                    this.apiError = false;
                    console.log('âœ… Loaded announcements from database:', this.announcements.length);
                    
                    // If empty, show info message but not error
                    if (data.length === 0) {
                        console.log('ðŸ“‹ No announcements available in database');
                    }
                } else {
                    console.log('ðŸ“‹ Invalid API response, keeping sample data');
                    this.apiError = true;
                }
                this.lastUpdated = new Date();
                // Re-initialize feather icons for dynamic content
                this.$nextTick(() => this.safeFeatherReplace());
            } else {
                console.error('âŒ API Error:', response.status, response.statusText);
                this.apiError = true;
                
                if (response.status === 401) {
                    console.error('ðŸ” Authentication Error: User not logged in or session expired');
                    // Don't redirect immediately, show fallback data first
                }
                
                // Keep existing sample data, don't reload
                console.log('ðŸ“‹ API failed, keeping existing sample data');
            }
        } catch (error) {
            console.error('ðŸ”¥ Network Error loading announcements:', error);
            this.apiError = true;
            // Keep existing sample data on network error
            console.log('ðŸ“‹ Network error, keeping existing sample data');
        } finally {
            this.loading = false;
        }
    },
    
    async loadAnnouncementsSilently() {
        // Silent refresh without loading indicators - for real-time polling
        try {
            const response = await fetch('/api/announcements');
            if (response.ok) {
                const data = await response.json();
                const previousCount = this.announcements.length;
                
                if (data && data.length >= 0) {
                    this.announcements = data;
                    this.lastUpdated = new Date();
                    
                    // Log changes for debugging
                    if (data.length > previousCount) {
                        console.log('âœ¨ New announcement detected! Total:', data.length);
                    } else if (data.length < previousCount) {
                        console.log('ðŸ—‘ï¸ Announcement removed or expired! Total:', data.length);
                    } else {
                        console.log('âœ… Announcements up to date:', data.length);
                    }
                    
                    // Re-initialize feather icons for any new content
                    this.$nextTick(() => this.safeFeatherReplace());
                }
            }
        } catch (error) {
            console.debug('Silent refresh failed:', error);
            // Don't show errors during silent refresh
        }
    },
    
    loadSampleData() {
        console.log('ðŸ“‹ Loading sample announcements data...');
        this.announcements = [
                    {
                        id: 1,
                        title: 'Health and Wellness Week',
                        content: 'Join us for Health and Wellness Week from October 15-19. Free health screenings, fitness activities, and wellness workshops available for all students.',
                        category: 'Health',
                        priority: 'high',
                        date: '2024-10-10',
                        author: 'Dr. Maria Santos',
                        read: false
                    },
                    {
                        id: 2,
                        title: 'Vaccination Drive Schedule',
                        content: 'Annual flu vaccination drive will be conducted on October 20-22. Please bring your health card and valid ID. Walk-ins welcome.',
                        category: 'Vaccination',
                        priority: 'high',
                        date: '2024-10-08',
                        author: 'Nurse Jennifer Cruz',
                        read: false
                    },
                    {
                        id: 3,
                        title: 'Clinic Hours Update',
                        content: 'Starting October 15, clinic hours will be extended until 7:00 PM on weekdays to better serve our students.',
                        category: 'General',
                        priority: 'medium',
                        date: '2024-10-05',
                        author: 'Admin Office',
                        read: true
                    },
                    {
                        id: 4,
                        title: 'Mental Health Awareness Month',
                        content: 'October is Mental Health Awareness Month. Free counseling sessions available. Schedule your appointment at the clinic.',
                        category: 'Mental Health',
                        priority: 'medium',
                        date: '2024-10-01',
                        author: 'Dr. Robert Kim',
                        read: true
                    },
                    {
                        id: 5,
                        title: 'Emergency Contact Information',
                        content: 'Please update your emergency contact information in your student profile. This helps us reach your family in case of medical emergencies.',
                        category: 'Emergency',
                        priority: 'low',
                        date: '2024-09-28',
                        author: 'Registration Office',
                        read: true
                    }
                ];
        this.lastUpdated = new Date();
        this.$nextTick(() => this.safeFeatherReplace());
    },
    
    async debugAPI() {
        console.log('ðŸ” DEBUG: Testing API connection...');
        console.log('ðŸ” Current URL:', window.location.href);
        console.log('ðŸ” Session cookies:', document.cookie);
        
        try {
            const response = await fetch('/api/announcements');
            console.log('ðŸ” Response status:', response.status);
            console.log('ðŸ” Response headers:', [...response.headers.entries()]);
            
            if (response.ok) {
                const data = await response.json();
                console.log('ðŸ” Response data:', data);
                alert(`âœ… API Working! Found ${data.length} announcements`);
            } else {
                const errorText = await response.text();
                console.log('ðŸ” Error response:', errorText);
                alert(`âŒ API Error: ${response.status} - ${response.statusText}\nResponse: ${errorText}`);
            }
        } catch (error) {
            console.log('ðŸ” Network error:', error);
            alert(`ðŸ”¥ Network Error: ${error.message}`);
        }
    },
    
    get filteredAnnouncements() {
        return this.announcements.filter(announcement => {
            const matchesCategory = this.selectedCategory === 'all' || announcement.category.toLowerCase() === this.selectedCategory.toLowerCase();
            const matchesSearch = announcement.title.toLowerCase().includes(this.searchQuery.toLowerCase()) || 
                                announcement.content.toLowerCase().includes(this.searchQuery.toLowerCase());
            return matchesCategory && matchesSearch;
        });
    },
    
    formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        });
    },
    
    getPriorityColor(priority) {
        switch(priority) {
            case 'high': return 'priority-high';
            case 'medium': return 'priority-medium';
            case 'low': return 'priority-low';
            default: return 'priority-medium';
        }
    },
    
    markAsRead(announcementId) {
        const announcement = this.announcements.find(a => a.id === announcementId);
        if (announcement) {
            announcement.read = true;
        }
    }
}" x-init="init()">
    
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside :class="sidebarCollapsed ? 'w-20' : 'w-64'" 
               class="fixed left-0 top-0 h-screen gradient-bg-sidebar text-white transition-all duration-300 shadow-2xl z-40">
        
            <!-- Logo -->
            <div class="relative p-6">
                <div class="flex items-center gap-3" :class="sidebarCollapsed ? 'justify-center' : ''">
                    <div class="flex items-center justify-center">
                        <img src="../assets/img/iclinic-logo.png" alt="Norzagaray College" class="w-14 h-14 object-contain">
                    </div>
                    <div x-show="!sidebarCollapsed" x-transition>
                        <h1 class="text-xl font-bold text-white">iClinic</h1>
                        <p class="text-xs text-yellow-300">Norzagaray College</p>
                    </div>
                </div>
            </div>
            
            <!-- Navigation -->
            <nav class="relative mt-8 px-4 space-y-3">
                <!-- Dashboard -->
                <a href="{{ url_for('student_dashboard') }}"
                   class="flex items-center gap-3 px-4 py-3 rounded-lg transition-all group hover:bg-white/10">
                    <div class="flex items-center justify-center" :class="sidebarCollapsed ? 'w-full' : ''">
                        <i data-feather="home" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                    </div>
                    <span x-show="!sidebarCollapsed" class="font-medium">Dashboard</span>
                </a>
                
                <!-- Health Records -->
                <a href="{{ url_for('student_health_records') }}"
                   class="flex items-center gap-3 px-4 py-3 rounded-lg transition-all group hover:bg-white/10">
                    <div class="flex items-center justify-center" :class="sidebarCollapsed ? 'w-full' : ''">
                        <i data-feather="file-text" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                    </div>
                    <span x-show="!sidebarCollapsed" class="font-medium">Health Records</span>
                </a>
                
                <!-- Appointments -->
                <a href="{{ url_for('student_appointments') }}"
                   class="flex items-center gap-3 px-4 py-3 rounded-lg transition-all group hover:bg-white/10">
                    <div class="flex items-center justify-center" :class="sidebarCollapsed ? 'w-full' : ''">
                        <i data-feather="calendar" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                    </div>
                    <span x-show="!sidebarCollapsed" class="font-medium">Appointments</span>
                </a>
                
                <!-- Consultation Chat -->
                <a href="{{ url_for('student_consultation_chat') }}"
                   class="flex items-center gap-3 px-4 py-3 rounded-lg transition-all group hover:bg-white/10">
                    <div class="flex items-center justify-center" :class="sidebarCollapsed ? 'w-full' : ''">
                        <i data-feather="message-circle" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                    </div>
                    <span x-show="!sidebarCollapsed" x-transition class="font-medium">Consultation Chat</span>
                </a>
                
                <!-- Announcements (Active) -->
                <a href="{{ url_for('student_announcements') }}"
                   class="sidebar-item-active flex items-center gap-3 px-4 py-3 rounded-lg transition-all group">
                    <div class="flex items-center justify-center" :class="sidebarCollapsed ? 'w-full' : ''">
                        <i data-feather="volume-2" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                    </div>
                    <span x-show="!sidebarCollapsed" class="font-medium">Announcements</span>
                </a>
            </nav>
        
            <!-- User Profile -->
            <div class="absolute bottom-0 w-full p-4 bg-gradient-to-t from-black/20 to-transparent" @click.outside="profileDropdown = false">
                <div class="relative">
                    <div class="flex items-center gap-2 mb-2">
                        <button @click="profileDropdown = !profileDropdown" class="flex-1 flex items-center gap-3 hover:bg-white/10 rounded-lg p-2 transition-all group" :class="sidebarCollapsed ? 'justify-center' : ''">
                            <div class="w-10 h-10 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center shadow-lg group-hover:scale-105 transition-transform">
                                <span class="text-white font-bold">{{ user.first_name[0] if user and user.first_name else 'S' }}{{ user.last_name[0] if user and user.last_name else 'T' }}</span>
                            </div>
                            <div x-show="!sidebarCollapsed" x-transition class="text-left">
                                <p class="text-sm font-medium text-white text-left">{{ user.first_name if user and user.first_name else 'Student' }} {{ user.last_name if user and user.last_name else 'User' }}</p>
                                <p class="text-xs text-green-300 text-left" style="font-size: 10px;">{{ user.position if user and user.position else 'Student' }}</p>
                            </div>
                            <!-- Chevron Icon -->
                            <svg x-show="!sidebarCollapsed" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 text-white/70 flex-shrink-0">
                                <polyline points="18 15 12 9 6 15"></polyline>
                            </svg>
                        </button>
                    </div>
                    
                    <!-- Profile Dropdown -->
                    <div x-show="profileDropdown" 
                         x-transition:enter="transition ease-out duration-200"
                         x-transition:enter-start="opacity-0 transform scale-95"
                         x-transition:enter-end="opacity-100 transform scale-100"
                         x-transition:leave="transition ease-in duration-150"
                         x-transition:leave-start="opacity-100 transform scale-100"
                         x-transition:leave-end="opacity-0 transform scale-95"
                         class="absolute bottom-full left-0 mb-2 w-48 bg-white rounded-lg shadow-xl border border-gray-200 py-2 z-50">
                        
                        <button @click="showLogoutConfirm = true; profileDropdown = false" class="w-full flex items-center gap-3 px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors">
                        <i data-feather="log-out" class="w-4 h-4 text-red-600"></i>
                        <span>Logout</span>
                    </button>
                    </div>
                </div>
            </div>
        </aside>
        
        <!-- Main Content Area -->
        <div :class="sidebarCollapsed ? 'md:ml-20' : 'md:ml-64'" class="flex-1 flex flex-col transition-all duration-300">
            <!-- Top Header Bar -->
            <header class="bg-white shadow-sm border-b border-gray-200">
                <div class="flex items-center justify-between px-4 py-3">
                    <!-- Left Side -->
                    <div class="flex items-center gap-4">
                        <!-- Mobile Menu Toggle -->
                        <button @click="sidebarCollapsed = !sidebarCollapsed" 
                                class="md:hidden p-2 rounded-lg hover:bg-gray-100 transition">
                            <i data-feather="menu" class="w-5 h-5 text-gray-600"></i>
                        </button>
                    </div>
                </div>
            </header>
            
            <!-- Main Announcements Content -->
            <main class="flex-1 overflow-y-auto bg-gray-50 p-6">
                <!-- Enhanced Announcements Header -->
                <div class="gradient-bg-sidebar text-white shadow-2xl relative overflow-hidden rounded-[2rem] ml-1 mb-6">
                    <!-- Decorative Elements -->
                    <div class="absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full -translate-y-32 translate-x-32"></div>
                    <div class="absolute bottom-0 left-0 w-48 h-48 bg-yellow-400/10 rounded-full translate-y-24 -translate-x-24"></div>
                    
                    <!-- Header Content -->
                    <div class="relative px-6 py-5">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                            <!-- Title Section -->
                            <div class="flex items-center gap-4">
                                <div class="relative">
                                    <div class="w-12 h-12 bg-yellow-400 rounded-xl flex items-center justify-center shadow-lg transform rotate-2 hover:rotate-0 transition-transform duration-300">
                                        <i data-feather="volume-2" class="w-6 h-6 text-blue-900"></i>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex items-center gap-2 mb-1">
                                        <h1 class="text-2xl sm:text-3xl font-bold text-white">
                                            Announcements
                                        </h1>
                                    </div>
                                    <div class="flex items-center gap-2 text-blue-100">
                                        <i data-feather="bell" class="w-3 h-3"></i>
                                        <span class="text-sm">Stay updated with clinic news and health alerts</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Refresh Button -->
                            <div class="flex items-center gap-2">
                                <button @click="loadAnnouncements()" 
                                        class="bg-yellow-400 text-blue-900 px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center gap-2 shadow-lg hover:shadow-xl hover:scale-105"
                                        :disabled="loading">
                                    <i data-feather="refresh-cw" class="w-4 h-4" :class="loading ? 'animate-spin' : ''"></i>
                                    <span x-text="loading ? 'Loading...' : 'Refresh'"></span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Announcement Statistics Cards -->
                <div class="mb-6">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5">
                        <!-- Total Announcements Card -->
                        <div class="stat-card bg-white rounded-xl shadow-md border border-gray-100 p-6 hover:shadow-xl transition-all duration-300" data-aos="fade-up" data-aos-delay="100">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <p class="text-xs font-semibold uppercase tracking-wide text-gray-500 mb-1">Total Announcements</p>
                                    <p class="text-3xl font-bold text-gray-900" x-text="announcements.length">0</p>
                                    <div class="flex items-center gap-2 mt-3">
                                        <span class="inline-flex items-center text-xs font-medium text-blue-600 bg-blue-50 px-2 py-1 rounded-full">
                                            All time
                                        </span>
                                    </div>
                                </div>
                                <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
                                    <i data-feather="volume-2" class="w-7 h-7 text-white"></i>
                                </div>
                            </div>
                        </div>
                    
                        <!-- Unread Announcements Card -->
                        <div class="stat-card bg-white rounded-xl shadow-md border border-gray-100 p-6 hover:shadow-xl transition-all duration-300" data-aos="fade-up" data-aos-delay="200">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <p class="text-xs font-semibold uppercase tracking-wide text-gray-500 mb-1">Unread</p>
                                    <p class="text-3xl font-bold text-gray-900" x-text="announcements.filter(a => !a.read).length">0</p>
                                    <div class="flex items-center gap-2 mt-3">
                                        <span class="inline-flex items-center text-xs font-medium text-green-600 bg-green-50 px-2 py-1 rounded-full">
                                            New updates
                                        </span>
                                    </div>
                                </div>
                                <div class="w-14 h-14 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center shadow-lg">
                                    <i data-feather="bell" class="w-7 h-7 text-white"></i>
                                </div>
                            </div>
                        </div>
                    
                        <!-- High Priority Card -->
                        <div class="stat-card bg-white rounded-xl shadow-md border border-gray-100 p-6 hover:shadow-xl transition-all duration-300" data-aos="fade-up" data-aos-delay="300">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <p class="text-xs font-semibold uppercase tracking-wide text-gray-500 mb-1">High Priority</p>
                                    <p class="text-3xl font-bold text-gray-900" x-text="announcements.filter(a => a.priority === 'high').length">0</p>
                                    <div class="flex items-center gap-2 mt-3">
                                        <span class="inline-flex items-center text-xs font-medium text-red-600 bg-red-50 px-2 py-1 rounded-full">
                                            Urgent
                                        </span>
                                    </div>
                                </div>
                                <div class="w-14 h-14 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center shadow-lg">
                                    <i data-feather="alert-circle" class="w-7 h-7 text-white"></i>
                                </div>
                            </div>
                        </div>
                    
                        <!-- This Month Card -->
                        <div class="stat-card bg-white rounded-xl shadow-md border border-gray-100 p-6 hover:shadow-xl transition-all duration-300" data-aos="fade-up" data-aos-delay="400">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <p class="text-xs font-semibold uppercase tracking-wide text-gray-500 mb-1">This Month</p>
                                    <p class="text-3xl font-bold text-gray-900" x-text="announcements.filter(a => new Date(a.date).getMonth() === new Date().getMonth() && new Date(a.date).getFullYear() === new Date().getFullYear()).length">0</p>
                                    <div class="flex items-center gap-2 mt-3">
                                        <span class="inline-flex items-center text-xs font-medium text-purple-600 bg-purple-50 px-2 py-1 rounded-full">
                                            Current month
                                        </span>
                                    </div>
                                </div>
                                <div class="w-14 h-14 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                                    <i data-feather="calendar" class="w-7 h-7 text-white"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Filters and Search -->
                <div class="mb-6">
                    <div class="bg-white rounded-xl shadow-md border border-gray-100 p-6">
                        <div class="flex flex-col md:flex-row gap-4 items-center justify-between">
                            <!-- Search -->
                            <div class="relative flex-1 max-w-md">
                                <i data-feather="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                <input type="text" 
                                       x-model="searchQuery"
                                       placeholder="Search announcements..." 
                                       class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            
                            <!-- Category Filter -->
                            <div class="flex gap-2 flex-wrap">
                                <button @click="selectedCategory = 'all'" 
                                        :class="selectedCategory === 'all' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                                        class="px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                    All
                                </button>
                                <button @click="selectedCategory = 'health'" 
                                        :class="selectedCategory === 'health' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                                        class="px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                    Health
                                </button>
                                <button @click="selectedCategory = 'vaccination'" 
                                        :class="selectedCategory === 'vaccination' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                                        class="px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                    Vaccination
                                </button>
                                <button @click="selectedCategory = 'general'" 
                                        :class="selectedCategory === 'general' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                                        class="px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                    General
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- API Status Banner -->
                <div x-show="apiError" class="mb-6">
                    <div class="bg-orange-50 border border-orange-200 rounded-xl p-4">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center">
                                <i data-feather="wifi-off" class="w-4 h-4 text-orange-600"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="text-sm font-semibold text-orange-800">Showing Sample Data</h3>
                                <p class="text-xs text-orange-600">Unable to connect to server. Displaying sample announcements for demonstration.</p>
                            </div>
                            <button @click="loadAnnouncements()" class="px-3 py-1 bg-orange-600 text-white text-xs rounded-lg hover:bg-orange-700 transition-colors">
                                Retry
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Announcements List -->
                <div class="space-y-6">
                    <!-- Loading State -->
                    <div x-show="loading" class="text-center py-12">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
                        <p class="text-gray-600 mt-4">Loading announcements...</p>
                    </div>
                    
                    <!-- Empty State: No Announcements in Database -->
                    <div x-show="!loading && !apiError && announcements.length === 0" class="text-center py-12">
                        <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-feather="volume-2" class="w-10 h-10 text-gray-400"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-900 mb-2">No Announcements Yet</h3>
                        <p class="text-gray-600">There are currently no announcements available.</p>
                        <p class="text-gray-500 text-sm mt-2">Check back later for updates from the clinic.</p>
                    </div>
                    
                    <!-- Announcements -->
                    <template x-for="announcement in filteredAnnouncements" :key="announcement.id">
                        <div class="announcement-card bg-white rounded-xl shadow-md border border-gray-100 overflow-hidden"
                             :class="!announcement.read ? 'border-l-4 border-l-blue-500' : ''"
                             data-aos="fade-up">
                            <div class="p-6">
                                <!-- Header -->
                                <div class="flex items-start justify-between mb-4">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-3 mb-2">
                                            <h3 class="text-xl font-bold text-gray-900" x-text="announcement.title"></h3>
                                            <span class="text-white text-xs px-2 py-1 rounded-full font-medium"
                                                  :class="getPriorityColor(announcement.priority)"
                                                  x-text="announcement.priority.toUpperCase()"></span>
                                            <span x-show="!announcement.read" class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full font-medium">
                                                NEW
                                            </span>
                                        </div>
                                        <div class="flex items-center gap-4 text-sm text-gray-600">
                                            <div class="flex items-center gap-1">
                                                <i data-feather="calendar" class="w-4 h-4"></i>
                                                <span x-text="formatDate(announcement.date)"></span>
                                            </div>
                                            <div class="flex items-center gap-1">
                                                <i data-feather="user" class="w-4 h-4"></i>
                                                <span x-text="announcement.author"></span>
                                            </div>
                                            <div class="flex items-center gap-1">
                                                <i data-feather="tag" class="w-4 h-4"></i>
                                                <span x-text="announcement.category"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Content -->
                                <div class="mb-4">
                                    <p class="text-gray-700 leading-relaxed" x-text="announcement.content"></p>
                                </div>
                                
                                <!-- Actions -->
                                <div class="flex items-center justify-between pt-4 border-t border-gray-100">
                                    <div class="flex items-center gap-2">
                                        <button @click="markAsRead(announcement.id)" 
                                                x-show="!announcement.read"
                                                class="text-blue-600 hover:text-blue-800 text-sm font-medium transition-colors">
                                            Mark as Read
                                        </button>
                                        <span x-show="announcement.read" class="text-green-600 text-sm font-medium">
                                            âœ“ Read
                                        </span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <button class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors">
                                            <i data-feather="bookmark" class="w-4 h-4"></i>
                                        </button>
                                        <button class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors">
                                            <i data-feather="share-2" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                    
                    <!-- Empty State: No Results from Filter -->
                    <div x-show="!loading && !apiError && announcements.length > 0 && filteredAnnouncements.length === 0" class="text-center py-12">
                        <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-feather="search" class="w-10 h-10 text-gray-400"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-900 mb-2">No Announcements Found</h3>
                        <p class="text-gray-600">Try adjusting your search or filter criteria.</p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Logout Confirmation Modal -->
    <div x-show="showLogoutConfirm" x-cloak
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
         @click.self="showLogoutConfirm = false">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4">
            <div class="p-6">
                <div class="flex items-center mb-4">
                    <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center mr-3">
                        <i data-feather="log-out" class="w-5 h-5 text-red-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900">Confirm Logout</h3>
                </div>
                
                <p class="text-gray-600 mb-6">Are you sure you want to logout? You will need to login again to access the system.</p>
                
                <div class="flex justify-end space-x-3">
                    <button @click="showLogoutConfirm = false"
                            class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                        Cancel
                    </button>
                    <a href="{{ url_for('logout') }}"
                       class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 inline-block text-center">
                        Yes, Logout
                    </a>
                </div>
            </div>
        </div>
    </div>

</body>
</html>
